# OurVerse ç”Ÿäº§ç¯å¢ƒè®¾ç½®æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡æ¸…å•

### âœ… å·²å®Œæˆçš„é…ç½®

1. **ç¯å¢ƒé…ç½®æ–‡ä»¶**
   - `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
   - `.env` - å®é™…é…ç½®ï¼ˆå·²åŒ…å«é»˜è®¤JWTå¯†é’¥å’Œé«˜å¾·åœ°å›¾APIï¼‰

2. **Dockeré…ç½®**
   - `docker-compose.yml` - å®Œæ•´çš„å®¹å™¨ç¼–æ’
   - `Dockerfile` - åº”ç”¨å®¹å™¨åŒ–é…ç½®
   - `healthcheck.js` - å¥åº·æ£€æŸ¥è„šæœ¬

3. **Nginxé…ç½®**
   - `nginx.conf` - åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡

4. **æ•°æ®åº“é…ç½®**
   - MongoDB 6.0 å®¹å™¨é…ç½®
   - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
   - ç´¢å¼•ä¼˜åŒ–é…ç½®

5. **éƒ¨ç½²è„šæœ¬**
   - `start-production.sh` - ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
   - `deploy.sh` - è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°éƒ¨ç½²ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰

```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh start-production.sh

# 2. è¿è¡Œè‡ªåŠ¨éƒ¨ç½²
./deploy.sh

# 3. æˆ–ç›´æ¥å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
./start-production.sh
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å¯åŠ¨DockeræœåŠ¡
docker-compose up -d --build

# 2. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹é‡è¦é¡¹ï¼š

```env
# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://mongodb:27017/ourverse

# JWT å¯†é’¥ï¼ˆå·²è‡ªåŠ¨ç”Ÿæˆï¼‰
JWT_SECRET=your-super-secret-jwt-key...

# é«˜å¾·åœ°å›¾APIï¼ˆå·²é…ç½®ï¼‰
AMAP_API_KEY=c8cb70e52409857f684c6fb41fc6e7b4

# OAuthé…ç½®ï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_CALLBACK_URL=https://yourdomain.com/api/auth/github/callback
```

### OAuthåº”ç”¨é…ç½®

#### GitHub OAuthé…ç½®

1. è®¿é—® [GitHub Settings > Developer settings > OAuth Apps](https://github.com/settings/applications/new)
2. åˆ›å»ºæ–°åº”ç”¨ï¼š
   - Application name: `OurVerse`
   - Homepage URL: `https://yourdomain.com`
   - Application description: `OurVerse Photo Sharing App`
   - Authorization callback URL: `https://yourdomain.com/api/auth/github/callback`
3. å¤åˆ¶ Client ID å’Œ Client Secret åˆ° `.env` æ–‡ä»¶

#### å¾®ä¿¡OAuthé…ç½®ï¼ˆå¯é€‰ï¼‰

1. è®¿é—® [å¾®ä¿¡å¼€æ”¾å¹³å°](https://open.weixin.qq.com/)
2. åˆ›å»ºç½‘ç«™åº”ç”¨
3. é…ç½®æˆæƒå›è°ƒåŸŸåï¼š`yourdomain.com`
4. å¤åˆ¶ AppID å’Œ AppSecret åˆ° `.env` æ–‡ä»¶

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ä¸»åº”ç”¨**: `https://localhost`
- **APIæœåŠ¡**: `http://localhost:3000`
- **ç§»åŠ¨ç«¯**: `https://[ä½ çš„IPåœ°å€]`

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®
docker-compose down -v

# é‡æ–°æ„å»º
docker-compose up -d --build
```

### æ•°æ®åº“ç®¡ç†

```bash
# è¿›å…¥MongoDBå®¹å™¨
docker-compose exec mongodb mongo ourverse

# å¤‡ä»½æ•°æ®åº“
docker-compose exec mongodb mongodump --db ourverse --out /data/backup

# æ¢å¤æ•°æ®åº“
docker-compose exec mongodb mongorestore --db ourverse /data/backup/ourverse
```

## ğŸ”’ å®‰å…¨é…ç½®

### SSLè¯ä¹¦é…ç½®

å½“å‰ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ã€‚å¦‚éœ€çœŸå®SSLè¯ä¹¦ï¼š

1. **ä½¿ç”¨Let's Encryptï¼ˆæ¨èï¼‰**
```bash
# å®‰è£…certbot
sudo apt-get install certbot

# ç”Ÿæˆè¯ä¹¦
sudo certbot certonly --webroot -w /usr/share/nginx/html -d yourdomain.com
```

2. **æ›´æ–°Nginxé…ç½®**
```nginx
ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
```

### é˜²ç«å¢™é…ç½®

```bash
# å¼€æ”¾ç«¯å£
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 3000

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f app
docker-compose logs -f nginx
```

### æ€§èƒ½ç›‘æ§

```bash
# å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# åº”ç”¨å¥åº·æ£€æŸ¥
curl http://localhost:3000/health
```

## ğŸ”„ å‡çº§éƒ¨ç½²

### è‡ªåŠ¨å‡çº§

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°éƒ¨ç½²
./deploy.sh
```

### æ‰‹åŠ¨å‡çº§

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# æ‹‰å–ä»£ç 
git pull

# é‡å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :80 -i :443 -i :3000

# åœæ­¢å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

2. **æƒé™é—®é¢˜**
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh

# ä¿®å¤ç›®å½•æƒé™
sudo chown -R $USER:$USER .
```

3. **å†…å­˜ä¸è¶³**
```bash
# å¢åŠ Dockerå†…å­˜é™åˆ¶
# Docker Desktop -> Settings -> Resources -> Advanced
```

4. **æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥MongoDBçŠ¶æ€
docker-compose exec mongodb mongo --eval "db.stats()"

# é‡å¯æ•°æ®åº“
docker-compose restart mongodb
```

### è°ƒè¯•æ¨¡å¼

```bash
# è¿›å…¥åº”ç”¨å®¹å™¨è°ƒè¯•
docker-compose exec app sh

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
docker-compose exec app env

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker-compose exec app node -e "require('mongoose').connect(process.env.MONGODB_URI).then(() => console.log('Connected'))"
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥ï¼š

1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs -f`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`docker-compose ps`
3. éªŒè¯é…ç½®ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶
4. æµ‹è¯•ç½‘ç»œï¼š`curl http://localhost:3000/health`

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **é…ç½®çœŸå®åŸŸåå’ŒSSLè¯ä¹¦**
2. **è®¾ç½®æ•°æ®åº“å®šæœŸå¤‡ä»½**
3. **é…ç½®æ—¥å¿—è½®è½¬å’Œç›‘æ§**
4. **è®¾ç½®è´Ÿè½½å‡è¡¡**
5. **é…ç½®CDNåŠ é€Ÿ**

### åŠŸèƒ½æ‰©å±•

1. **æ·»åŠ ç”¨æˆ·æ³¨å†Œå’Œç™»å½•é¡µé¢**
2. **å®ç°ç…§ç‰‡ç¼–è¾‘åŠŸèƒ½**
3. **æ·»åŠ ç¤¾äº¤åŠŸèƒ½**
4. **é›†æˆæ›´å¤šåœ°å›¾æœåŠ¡**
5. **æ·»åŠ ç§»åŠ¨ç«¯App**

---

**ğŸ‰ æ­å–œï¼æ‚¨çš„OurVerseåº”ç”¨å·²æˆåŠŸéƒ¨ç½²ï¼**

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªåŸºäºåœ°ç†ä½ç½®çš„ç…§ç‰‡åˆ†äº«åº”ç”¨äº†ã€‚è®°å¾—é…ç½®OAuthåº”ç”¨ä»¥å¯ç”¨å®Œæ•´çš„ç™»å½•åŠŸèƒ½ã€‚
